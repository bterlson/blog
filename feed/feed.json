{
	"version": "https://jsonfeed.org/version/1.1",
	"title": "Brian&#39;s Blog",
	"language": "en",
	"home_page_url": "https://blog.trl.sn/",
	"feed_url": "https://blog.trl.sn/feed/feed.json",
	"description": "Musings on TypeSpec, OpenAPI, API-first, etc.",
	"author": {
		"name": "Brian Terlson",
		"url": "https://blog.trl.sn"
	},
	"items": [
		{
			"id": "https://blog.trl.sn/blog/what-is-a-json-number/",
			"url": "https://blog.trl.sn/blog/what-is-a-json-number/",
			"title": "What is a JSON Number?",
			"content_html": "<p>Not a question people generally ponder, and seems fairly straightforward. It's a number, <em>obviously</em>! But the question turns out to be somewhat hard to answer, and for API designers especially, the answer is really important to know! So lets explore by diving into the various JSON specifications and implementations. The findings are summarized at the end, so feel free to skip to the bottom if you just want to know the answer and not wade through the exploration.</p>\n<h2>Table of contents</h2>\n<p></p><div class=\"table-of-contents\"><ol><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Authoritative sources </a><ol><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">ECMA-404 </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">RFC 8259 </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">RFC 7493 </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">JSON Schema &amp; OpenAPI </a></li></ol></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">JSON numbers in practice </a><ol><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Language implementations </a><ol><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">JavaScript </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Python 3.8 </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">C# (.NET 8, System.Text.JSON) </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Java (JDK 11+, Jackson) </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Rust (serde) </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Go </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Summary </a></li></ol></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">OpenAPI code generators </a></li></ol></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Summary of findings </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Appendix: Test Code </a><ol><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">JavaScript </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">C# </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Python (3.8) </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Java (JDK 21, Jackson) </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Rust </a></li><li><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">Go </a></li></ol></li></ol></div><p></p>\n<h2 id=\"authoritative-sources\" tabindex=\"-1\">Authoritative sources <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h2>\n<p>JSON is defined by two primary standards: <a href=\"https://ecma-international.org/wp-content/uploads/ECMA-404_2nd_edition_december_2017.pdf\">Ecma-404</a> and <a href=\"https://datatracker.ietf.org/doc/html/rfc8259\">RFC 8259</a>. Both standards are semantically identical, but RFC 8259 provides some additional recommendations for good interoperability. A related standard, <a href=\"https://datatracker.ietf.org/doc/html/rfc7493\">RFC 7493</a>, describes the closely related Internet JSON format, a restricted profile of JSON which adds a bit more teeth to the recommendations found in RFC 8259. Additionally, in the context of API descriptions, <a href=\"https://json-schema.org/draft/2020-12/json-schema-core\">JSON Schema</a> defines a number data type, which is also normatively referenced by <a href=\"https://spec.openapis.org/oas/v3.1.0\">OpenAPI</a>. Let's look at each of these specifications for clues.</p>\n<h3 id=\"ecma-404\" tabindex=\"-1\">ECMA-404 <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<blockquote>\n<p>A number is a sequence of decimal digits with no superfluous leading zero. It may have a preceding minus sign (U+002D). It may have a fractional part prefixed by a decimal point (U+002E). It may have an exponent, prefixed by e (U+0065) or E (U+0045) and optionally + (U+002B) or â€“ (U+002D)</p>\n</blockquote>\n<p>So, a JSON number is a sequence of digits with an optional sign, fractional part, and exponent. The description is purely syntactical.</p>\n<h3 id=\"rfc-8259\" tabindex=\"-1\">RFC 8259 <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<p>This specification provides an equivalent ABNF grammar to the railroad diagrams provided by ECMA-404. It also explicitly allows implementations to set limits on the range and precision of numbers accepted<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" id=\"fnref1\">[1]</a></sup>. It goes on to note:</p>\n<blockquote>\n<p>Since software that implements IEEE 754 binary64 (double precision) numbers is generally available and widely used, good interoperability can be achieved by implementations that expect no more precision or range than these provide</p>\n</blockquote>\n<p>This is pointing out that some JSON implementations use doubles to store JSON number values. The implementation found in browsers and used by billions of people around the world is one such implementation. So a JSON number will be interoperable if its range and precision fit within a double.</p>\n<h3 id=\"rfc-7493\" tabindex=\"-1\">RFC 7493 <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<p>This specification makes RFC 8259's informative note a normative SHOULD NOT:</p>\n<blockquote>\n<p>I-JSON messages SHOULD NOT include numbers that express greater magnitude or precision than an IEEE 754 double precision number provides</p>\n</blockquote>\n<p>It goes on to recommend that if you need greater range or precision, that you should encode the number as a string.</p>\n<h3 id=\"json-schema-and-openapi\" tabindex=\"-1\">JSON Schema &amp; OpenAPI <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<p>JSON Schema describes a number as:</p>\n<blockquote>\n<p>An arbitrary-precision, base-10 decimal number value, from the JSON &quot;number&quot; value</p>\n</blockquote>\n<p>JSON Schema and OpenAPI also define the concept of an integer. JSON schema defines an integer in terms of its value, as a number with a zero fractional part. It also notes that integer values SHOULD NOT be encoded with a fractional part. OpenAPI defines an integer in terms of its syntax, as a JSON number without a fractional part or exponent part.</p>\n<h2 id=\"json-numbers-in-practice\" tabindex=\"-1\">JSON numbers in practice <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h2>\n<p>RFC 8259 raises the important point that ultimately implementations decide what a JSON number is. Certainly there are limits to range and precision in practice, but what are they? We know that at least one extremely widely deployed implementation is limited to double precision. Are there other interoperability concerns to consider? Let's investigate by going down two parallel tracks: JSON parsers and serializers across some common languages, and code generators in the OpenAPI ecosystem.</p>\n<h3 id=\"language-implementations\" tabindex=\"-1\">Language implementations <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<p>Language implementations ultimately decide what a JSON number is, so let's look at a few examples and check for common patterns. For languages which have configurable serialization/deserialization, only the default behavior is covered.</p>\n<h4 id=\"javascript\" tabindex=\"-1\">JavaScript <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>JavaScript's built-in JSON implementation only works with the built-in <code>Number</code> type, so all values are limited to the range and precision of a double. Serialization of <code>BigInt</code> is not supported by default. JavaScript also makes it impossible to preserve a numeric literal exactly when round-tripping, e.g. integers-as-decimals like <code>1.0</code> will be put back on the wire as <code>1</code>. There is a <a href=\"https://github.com/tc39/proposal-json-parse-with-source\">language proposal</a> to allow fixing both of these issues without swapping out the entire parser.</p>\n<h4 id=\"python-3-8\" tabindex=\"-1\">Python 3.8 <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>Integers, decimals, and exponentials are treated differently. Integers can round trip as JSON numbers within the range of -10<sup>4299</sup> to 10<sup>4299</sup><sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" id=\"fnref2\">[2]</a></sup>, while decimals and exponentials use doubles and so are limited to double range and precision. Integers outside the range an <code>int</code> can be serialized to result in a <code>ValueError</code>. Exponentials and decimals outside the range of doubles result in <code>inf</code>. When parsing then serializing exponentials, the exponential formatting is lost.</p>\n<h4 id=\"c-net-8-system-text-json\" tabindex=\"-1\">C# (.NET 8, System.Text.JSON) <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>C#'s <code>System.Text.JSON</code> library is the recommended way to handle JSON data these days, though <code>Newtonsoft.JSON</code> is also commonly used. We examine the behavior of the former, the latter likely differs.</p>\n<p>C# supports deserializing into appropriate data types through the use of <code>TryGet*</code> APIs. Using this API, it is possible to deserialize integer types losslessly up to <code>int64</code> and somewhat larger integers into a <code>decimal</code>. <code>decimal</code> can also be used to represent decimal values, potentially with precision loss. If you know the schema in advance, you can add support for deserializing into other data types, like <code>BigInteger</code>.</p>\n<h4 id=\"java-jdk-11-jackson\" tabindex=\"-1\">Java (JDK 11+, Jackson) <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>Java typically uses the <code>Jackson</code> library to handle JSON serialization and deserialization. <code>Jackson</code> allows serialization and deserialization into any Java numeric type, including <code>BigDecimal</code>, allowing it to represent numeric literals of any range and precision without precision loss.</p>\n<h4 id=\"rust-serde\" tabindex=\"-1\">Rust (serde) <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>Rust's <code>serde_json</code> crate is commonly used for JSON serialization and deserialization. It supports deserialization of integer values that fit within the range of an <code>i64</code>/<code>u64</code>. It also supports deserialization of integer and decimal values that fit within the range of an <code>f64</code>, though doing so may result in precision loss. Integers and decimals outside the range of an <code>f64</code> result in an error. Exponentials are always deserialized as doubles. However, <code>serde</code> has a <code>arbitrary_precision</code> configuration flag that can be used to round-trip arbitrary numeric values without precision loss assuming they are not deserialized in a lossy fashion. Support for deseralizing into other data types can be added with some additional code, but requires knowing the schema of the data.</p>\n<h4 id=\"go\" tabindex=\"-1\">Go <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>Go's <code>encoding/json</code> library is capable of dynamically unmarshalling JSON number literals using the<code>float64</code> type. If you know the schema in advance, you can parse known integers into an appropriate integer type up to <code>int64</code>, and parse decimals into a <code>float32</code> type as appropriate. Support for unmarshalling e.g. decimal types or big integers can be added with some additional code, but also requires knowing the schema of the data.</p>\n<h4 id=\"summary\" tabindex=\"-1\">Summary <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h4>\n<p>To summarize the behavior of the various implementations, we can examine their behavior with the following values:</p>\n<style>\n  #literal-table tr td:nth-child(1), #literal-table tr th:nth-child(1) {\n    text-align: right;\n  }\n</style>\n<div id=\"literal-table\">\n<table>\n<thead>\n<tr>\n<th>Number literal</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>10</td>\n<td>Small integer</td>\n</tr>\n<tr>\n<td>1000000000</td>\n<td>Medium integer: beyond int32 range, within int64 range</td>\n</tr>\n<tr>\n<td>10000000000000001</td>\n<td>Large integer: beyond double range, within int64 range</td>\n</tr>\n<tr>\n<td>100000000000000000001</td>\n<td>Huge integer: beyond the range of an int64</td>\n</tr>\n<tr>\n<td>1[309 zeros]</td>\n<td>Ridonculous integer: beyond the range of a decimal128</td>\n</tr>\n<tr>\n<td>10.0</td>\n<td>Low-precision decimal</td>\n</tr>\n<tr>\n<td>10000000000000001.1</td>\n<td>High-precision decimal: precision &gt; double</td>\n</tr>\n<tr>\n<td>1.[34 ones]</td>\n<td>Ridonculous-precision decimal: precision &gt; decimal128</td>\n</tr>\n<tr>\n<td>1E2</td>\n<td>Small expontential</td>\n</tr>\n<tr>\n<td>1E309</td>\n<td>Large exponential: beyond the range of a float</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>The following table shows the data type used to represent the literal in each language. Cells colored with grey are errors. Cells colored with red are non-errors with precision loss. Only the default serialization behavior is covered here. It may be possible to code defensively against these kinds of errors by configuring the serializer or through other mechanisms. Additionally, the test code I used attempts to use a dynamic/schemaless parsing path if it is available. For some languages, knowing the schema in advance can result in better behavior. The test code can be found in the appendix.</p>\n<style>\n  #lrt tr td:nth-child(1), #lrt tr th:nth-child(1) {\n    text-align: right;\n  }\n\n  #lrt tr:nth-child(3) td:nth-child(2),\n  #lrt tr:nth-child(4) td:nth-child(2),\n  #lrt tr:nth-child(5) td:nth-child(2),\n  #lrt tr:nth-child(7) td:nth-child(2),\n  #lrt tr:nth-child(8) td:nth-child(2),\n  #lrt tr:nth-child(10) td:nth-child(2),\n\n  #lrt tr:nth-child(8) td:nth-child(3),\n\n  #lrt tr:nth-child(7) td:nth-child(4),\n  #lrt tr:nth-child(8) td:nth-child(4),\n  #lrt tr:nth-child(10) td:nth-child(4),\n\n  #lrt tr:nth-child(3) td:nth-child(6),\n  #lrt tr:nth-child(4) td:nth-child(6),\n  #lrt tr:nth-child(5) td:nth-child(6),\n  #lrt tr:nth-child(7) td:nth-child(6),\n  #lrt tr:nth-child(8) td:nth-child(6),\n\n  #lrt tr:nth-child(4) td:nth-child(7),\n  #lrt tr:nth-child(7) td:nth-child(7),\n  #lrt tr:nth-child(8) td:nth-child(7)\n  {\n    background-color: #f99;\n  }\n\n  #lrt tr:nth-child(5) td:nth-child(3),\n  #lrt tr:nth-child(10) td:nth-child(3),\n  \n  #lrt tr:nth-child(5) td:nth-child(6),\n  #lrt tr:nth-child(10) td:nth-child(6),\n\n  #lrt tr:nth-child(5) td:nth-child(7),\n  #lrt tr:nth-child(10) td:nth-child(7)\n  {\n    background-color: #ccc;\n  }\n</style>\n<div id=\"lrt\">\n<table>\n<thead>\n<tr>\n<th>Literal</th>\n<th>JavaScript</th>\n<th>C#</th>\n<th>Python</th>\n<th>Java</th>\n<th>Go</th>\n<th>Rust</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Small integer</td>\n<td>Number</td>\n<td>int16</td>\n<td>int</td>\n<td>int</td>\n<td>float64</td>\n<td>i8</td>\n</tr>\n<tr>\n<td>Medium integer</td>\n<td>Number</td>\n<td>int64</td>\n<td>int</td>\n<td>long</td>\n<td>float64</td>\n<td>i64</td>\n</tr>\n<tr>\n<td>Large integer</td>\n<td>Number</td>\n<td>int64</td>\n<td>int</td>\n<td>long</td>\n<td>float64</td>\n<td>i64</td>\n</tr>\n<tr>\n<td>Huge integer</td>\n<td>Number</td>\n<td>decimal</td>\n<td>int</td>\n<td>BigInteger</td>\n<td>float64</td>\n<td>f64</td>\n</tr>\n<tr>\n<td>Ridonculous integer</td>\n<td>Number</td>\n<td>error</td>\n<td>int</td>\n<td>BigInteger</td>\n<td>error</td>\n<td>error</td>\n</tr>\n<tr>\n<td>Low-precision decimal</td>\n<td>Number</td>\n<td>decimal</td>\n<td>double</td>\n<td>float</td>\n<td>float64</td>\n<td>f64</td>\n</tr>\n<tr>\n<td>High-precision decimal</td>\n<td>Number</td>\n<td>decimal</td>\n<td>double</td>\n<td>BigDecimal</td>\n<td>float64</td>\n<td>f64</td>\n</tr>\n<tr>\n<td>Ridonculous-precision decimal</td>\n<td>Number</td>\n<td>decimal</td>\n<td>double</td>\n<td>BigDecimal</td>\n<td>float64</td>\n<td>f64</td>\n</tr>\n<tr>\n<td>Small exponential</td>\n<td>Number</td>\n<td>decimal</td>\n<td>double</td>\n<td>float</td>\n<td>float64</td>\n<td>f64</td>\n</tr>\n<tr>\n<td>Large exponential</td>\n<td>Number</td>\n<td>error</td>\n<td>double</td>\n<td>BigDecimal</td>\n<td>error</td>\n<td>error</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>Notes:</p>\n<ul>\n<li><strong>C#</strong>: The test code attempts to deserialize into the smallest supported int <code>int16</code>, then <code>int64</code>, then <code>decimal</code>. No attempt is made to deserialize into a <code>double</code> at this point, since it would only have the value of <code>+/- Infinity</code>. Also note that <code>decimal</code> is not an IEEE <code>decimal128</code> - the former has 28-29 significant digits, whereas <code>decimal128</code> has 34.</li>\n<li><strong>Rust</strong>: The type in this column represents the smallest possible type the value will deserialize into without error. If you know the schema in advance, you can make trivially make the huge integer case an error to avoid precision loss.</li>\n<li><strong>Go</strong>: You can serialize into integer types if you know the schema of the data and can ask the unmarshaller to give you an int64. The table represents the best you can do if you don't know the schema in advance. If you know the schema, you can handle the large integer case without precision loss, and also make the huge integer case an error.</li>\n</ul>\n<h3 id=\"openapi-code-generators\" tabindex=\"-1\">OpenAPI code generators <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<p>In the context of JSON APIs, an argument could be made that OpenAPI and its ecosystem of code generators matter as much as the parsers found in various implementations. Even if a language's JSON parser is capable of parsing a number literal of a particular size, it's possible OpenAPI's signatures could be more or less restrictive, especially for strongly typed languages.</p>\n<p>In order to understand how the various languages behave, we will test with numeric types and formats defined in the OpenAPI 3 spec itself, as well as the numeric formats defined in the <a href=\"https://spec.openapis.org/registry/format/\">OpenAPI Format Registry</a>:</p>\n<table>\n<thead>\n<tr>\n<th>Type</th>\n<th>Format</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>number</td>\n<td></td>\n<td>Arbitrary-precision, base-10 decimal number value</td>\n</tr>\n<tr>\n<td>integer</td>\n<td></td>\n<td>JSON number without a fraction or exponent part</td>\n</tr>\n<tr>\n<td>number</td>\n<td>float</td>\n<td>Single precision floating point number</td>\n</tr>\n<tr>\n<td>number</td>\n<td>double</td>\n<td>Double precision floating point number</td>\n</tr>\n<tr>\n<td>number</td>\n<td>decimal</td>\n<td>Fixed point decimal number of unspecified precision and range</td>\n</tr>\n<tr>\n<td>number</td>\n<td>decimal128</td>\n<td>Decimal floating-point number with 34 significant decimal digits</td>\n</tr>\n<tr>\n<td>integer</td>\n<td>int8</td>\n<td>Signed 8-bit integer</td>\n</tr>\n<tr>\n<td>integer</td>\n<td>uint8</td>\n<td>Unsigned 8-bit integer</td>\n</tr>\n<tr>\n<td>integer</td>\n<td>int16</td>\n<td>Signed 16-bit integer</td>\n</tr>\n<tr>\n<td>integer</td>\n<td>int32</td>\n<td>Signed 32-bit integer</td>\n</tr>\n<tr>\n<td>integer</td>\n<td>int64</td>\n<td>Signed 64-bit integer</td>\n</tr>\n</tbody>\n</table>\n<p>Unsigned ints other than <code>uint8</code> are not defined in either OpenAPI or the format registry. <code>double-int</code> was recently added<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" id=\"fnref3\">[3]</a></sup> and is unlikely to be supported anywhere.</p>\n<p>The table below summarizes the output for each language using the <a href=\"https://openapi-generator.tech/\">OpenAPI-Generator</a> code generators. Cells higlighted in red show cases where the generated code creates a situation where either precision loss or an error may occur when providing certain values in OpenAPI's spec-defined range and precision.</p>\n<style>\n#result-table tr:nth-child(1) td:nth-child(2),\n#result-table tr:nth-child(2) td:nth-child(2),\n#result-table tr:nth-child(8) td:nth-child(2),\n#result-table tr:nth-child(11) td:nth-child(2),\n#result-table tr:nth-child(12) td:nth-child(2),\n\n#result-table tr:nth-child(1) td:nth-child(3),\n#result-table tr:nth-child(2) td:nth-child(3),\n#result-table tr:nth-child(7) td:nth-child(3),\n#result-table tr:nth-child(11) td:nth-child(3),\n\n#result-table tr:nth-child(1) td:nth-child(4),\n#result-table tr:nth-child(12) td:nth-child(4),\n#result-table tr:nth-child(11) td:nth-child(4),\n#result-table tr:nth-child(12) td:nth-child(4),\n\n#result-table tr:nth-child(2) td:nth-child(5),\n#result-table tr:nth-child(7) td:nth-child(5),\n\n#result-table tr:nth-child(1) td:nth-child(6),\n#result-table tr:nth-child(2) td:nth-child(6),\n#result-table tr:nth-child(7) td:nth-child(6),\n#result-table tr:nth-child(11) td:nth-child(6),\n#result-table tr:nth-child(12) td:nth-child(6),\n\n#result-table tr:nth-child(1) td:nth-child(7),\n#result-table tr:nth-child(2) td:nth-child(7),\n#result-table tr:nth-child(7) td:nth-child(7),\n#result-table tr:nth-child(11) td:nth-child(7),\n#result-table tr:nth-child(12) td:nth-child(7)\n{\n  background-color: #f99;\n}\n</style>\n<div id=\"result-table\">\n<table>\n<thead>\n<tr>\n<th>OpenAPI</th>\n<th>JavaScript</th>\n<th>C#</th>\n<th>Python</th>\n<th>Java</th>\n<th>Go</th>\n<th>Rust</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>number</td>\n<td>number</td>\n<td>decimal128</td>\n<td>int, float</td>\n<td>BigDecimal</td>\n<td>float32</td>\n<td>f32</td>\n</tr>\n<tr>\n<td>integer</td>\n<td>number</td>\n<td>int32</td>\n<td>int</td>\n<td>Integer</td>\n<td>int32</td>\n<td>i32</td>\n</tr>\n<tr>\n<td>int8</td>\n<td>number</td>\n<td>int32</td>\n<td>int</td>\n<td>Integer</td>\n<td>int32</td>\n<td>i32</td>\n</tr>\n<tr>\n<td>uint8</td>\n<td>number</td>\n<td>int32</td>\n<td>int</td>\n<td>Integer</td>\n<td>int32</td>\n<td>i32</td>\n</tr>\n<tr>\n<td>int16</td>\n<td>number</td>\n<td>int32</td>\n<td>int</td>\n<td>Integer</td>\n<td>int32</td>\n<td>i32</td>\n</tr>\n<tr>\n<td>int32</td>\n<td>number</td>\n<td>int32</td>\n<td>int</td>\n<td>Integer</td>\n<td>int32</td>\n<td>i32</td>\n</tr>\n<tr>\n<td>double-int</td>\n<td>number</td>\n<td>int32</td>\n<td>int</td>\n<td>Integer</td>\n<td>int32</td>\n<td>i32</td>\n</tr>\n<tr>\n<td>int64</td>\n<td>number</td>\n<td>int64</td>\n<td>int</td>\n<td>Long</td>\n<td>int64</td>\n<td>i64</td>\n</tr>\n<tr>\n<td>single</td>\n<td>number</td>\n<td>float</td>\n<td>int, float</td>\n<td>Float</td>\n<td>float32</td>\n<td>f32</td>\n</tr>\n<tr>\n<td>double</td>\n<td>number</td>\n<td>double</td>\n<td>int, float</td>\n<td>Double</td>\n<td>float64</td>\n<td>f64</td>\n</tr>\n<tr>\n<td>decimal</td>\n<td>number</td>\n<td>decimal128</td>\n<td>int, float</td>\n<td>BigDecimal</td>\n<td>float32</td>\n<td>f32</td>\n</tr>\n<tr>\n<td>decimal128</td>\n<td>number</td>\n<td>decimal128</td>\n<td>int, float</td>\n<td>BigDecimal</td>\n<td>float32</td>\n<td>f32</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>From this we can see that the OpenAPI-generator suite considers an <code>integer</code> to be an int32, despite the spec suggesting it has arbitrary range. As such, when using these tools, there seems to be no way to define an arbitrary-length integer across all languages that have a corresponding data type. Moreover, <code>number</code> is often understood as a 32-bit <code>float</code> despite the spec suggesting it has arbitrary range and precision.</p>\n<h2 id=\"summary-of-findings\" tabindex=\"-1\">Summary of findings <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h2>\n<p>Let's answer the question then: what is a JSON number?</p>\n<ul>\n<li>According to the authoritative specs, a numeric literal of any length and precision.</li>\n<li>According to an interoperable profile of JSON, a numeric literal with the length and precision of a double.</li>\n<li>According to various JSON implementations, a numeric literal with constraints that differ wildly depending on the implementation.</li>\n<li>According to OpenAPI, either:\n<ul>\n<li>An integer of any length</li>\n<li>A decimal value of any length and precision</li>\n</ul>\n</li>\n<li>According to OpenAPI code generators,\n<ul>\n<li>Without a format, either:\n<ul>\n<li>For <code>number</code>, some floating point representation as small as float32</li>\n<li>For <code>integer</code>, an int32</li>\n</ul>\n</li>\n<li>With a format, either:\n<ul>\n<li>the closest data type approximating the specified format in that language</li>\n<li><code>int32</code> or its closest approximation if the format is not supported.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>We have also confirmed that interoperability of numbers outside the range of a double is spotty. All implementations tested can transact numbers inside the double range safely. All implementations except JavaScript can transact integer literals within the range of an <code>int64</code><sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" id=\"fnref4\">[4]</a></sup> (though go requires knowing the schema in advance).</p>\n<p>For those using OpenAPI, we can infer some best practices for defining APIs that use numbers:</p>\n<ul>\n<li>Always specify a format in OpenAPI. Neither <code>integer</code> or <code>number</code> is likely to do what you want.</li>\n<li>Avoid <code>double-int</code>. It's not supported and results in potential errors or data loss in many languages.</li>\n<li>Avoid <code>decimal</code> and <code>decimal128</code>. They are also not widely supported.</li>\n<li>Avoid <code>int64</code> with a <code>number</code> type if you have JavaScript consumers. Use with the <code>string</code> type instead.</li>\n</ul>\n<p>If you're using TypeSpec, this advice can be summed up as:</p>\n<ul>\n<li>Avoid using <code>decimal</code>, <code>decimal128</code>, <code>integer</code>, and <code>numeric</code> types.</li>\n<li>If you use <code>int64</code> and you have JavaScript consumers, encode it as a string via <code>@encode(&quot;int64&quot;, string)</code>.</li>\n</ul>\n<p>Finally, due to some languages handling numeric literals with exponential and decimal parts differently, implementations should preserve the format when round tripping (e.g. <code>10.0</code> should be put back as <code>10.0</code>).</p>\n<h2 id=\"appendix-test-code\" tabindex=\"-1\">Appendix: Test Code <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h2>\n<p>This code is garbage, LLMs were heavily involved in their creation. The output needs some interpretation. Feel free to <a href=\"https://github.com/bterlson/blog/blob/main/content/blog/what-is-a-json-number.md\">suggest improvements on GitHub</a>.</p>\n<h3 id=\"javascript-1\" tabindex=\"-1\">JavaScript <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">const</span><span style=\"color:#575279;font-style:italic\"> jsonValues</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279\"> [</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"10\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"1000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"10000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"100000000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"1\"</span><span style=\"color:#286983\"> +</span><span style=\"color:#EA9D34\"> \"0\"</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">repeat</span><span style=\"color:#575279\">(</span><span style=\"color:#D7827E\">309</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"10.0\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"10000000000000001.1\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"1.1111111111111111111111111111111111\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"1E2\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"1E309\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#575279\">]</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">for</span><span style=\"color:#575279\"> (</span><span style=\"color:#286983\">const</span><span style=\"color:#575279;font-style:italic\"> jsonValue</span><span style=\"color:#286983\"> of</span><span style=\"color:#575279;font-style:italic\"> jsonValues</span><span style=\"color:#575279\">) </span><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tconsole</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">log</span><span style=\"color:#575279\">(</span><span style=\"color:#EA9D34\">`Testing JSON value: </span><span style=\"color:#797593\">${</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">`</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">\ttry</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Deserialize the JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tconst</span><span style=\"color:#575279;font-style:italic\"> deserialized</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> JSON</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">parse</span><span style=\"color:#575279\">(</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279\"> (</span><span style=\"color:#D7827E\">String</span><span style=\"color:#575279\">(</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#575279\">) </span><span style=\"color:#286983\">!==</span><span style=\"color:#575279;font-style:italic\"> jsonValue</span><span style=\"color:#575279\">) </span><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tconsole</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">log</span><span style=\"color:#575279\">(</span><span style=\"color:#EA9D34\">\"precision loss detected\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> jsonValue</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> deserialized</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tconst</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> JSON</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">stringify</span><span style=\"color:#575279\">(</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279\"> (</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#286983\"> !==</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#575279\">) </span><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tconsole</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">log</span><span style=\"color:#575279\">(</span><span style=\"color:#EA9D34\">\"round-trip error detected\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> jsonValue</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t}</span><span style=\"color:#286983\"> catch</span><span style=\"color:#575279\"> (</span><span style=\"color:#575279;font-style:italic\">error</span><span style=\"color:#575279\">) </span><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tconsole</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">log</span><span style=\"color:#575279\">(</span><span style=\"color:#EA9D34\">`Deserialization error: </span><span style=\"color:#797593\">${</span><span style=\"color:#575279;font-style:italic\">error</span><span style=\"color:#286983\">.</span><span style=\"color:#575279;font-style:italic\">message</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">`</span><span style=\"color:#575279\">)</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tconsole</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">log</span><span style=\"color:#575279\">()</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<h3 id=\"c\" tabindex=\"-1\">C# <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">using</span><span style=\"color:#56949F\"> System</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">using</span><span style=\"color:#56949F\"> System</span><span style=\"color:#286983\">.</span><span style=\"color:#56949F\">Text</span><span style=\"color:#286983\">.</span><span style=\"color:#56949F\">Json</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">class</span><span style=\"color:#56949F\"> Program</span></span>\n<span class=\"line\"><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    static</span><span style=\"color:#286983\"> void</span><span style=\"color:#D7827E\"> Main</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">        string</span><span style=\"color:#797593\">[]</span><span style=\"color:#D7827E\"> jsonValues</span><span style=\"color:#286983\"> =</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"10\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"1000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"10000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"100000000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"1\"</span><span style=\"color:#286983\"> +</span><span style=\"color:#286983\"> new</span><span style=\"color:#286983\"> string</span><span style=\"color:#797593\">(</span><span style=\"color:#797593\">'</span><span style=\"color:#EA9D34\">0</span><span style=\"color:#797593\">'</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 309</span><span style=\"color:#797593\">),</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"10.0\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"10000000000000001.1\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"1.1111111111111111111111111111111111\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"1E2\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">            \"1E309\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#797593\">        };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">        foreach</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">string</span><span style=\"color:#D7827E\"> jsonValue</span><span style=\"color:#286983\"> in</span><span style=\"color:#575279;font-style:italic\"> jsonValues</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">        {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">            Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Testing JSON value: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">            try</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            {</span></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Deserialize the JSON value</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">                JsonElement</span><span style=\"color:#D7827E\"> deserialized</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> JsonSerializer</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">Deserialize</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">JsonElement</span><span style=\"color:#797593\">>(</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Check the deserialized type and precision loss</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                switch</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#286983\">.</span><span style=\"color:#575279;font-style:italic\">ValueKind</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    case</span><span style=\"color:#56949F\"> JsonValueKind</span><span style=\"color:#286983\">.</span><span style=\"color:#56949F\">Number</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\t\t\t\tif</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">TryGetInt16</span><span style=\"color:#797593\">(</span><span style=\"color:#286983\">out</span><span style=\"color:#286983\"> short</span><span style=\"color:#D7827E\"> smallValue</span><span style=\"color:#797593\">))</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                            Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: short\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                        else</span><span style=\"color:#286983\"> if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">TryGetInt64</span><span style=\"color:#797593\">(</span><span style=\"color:#286983\">out</span><span style=\"color:#286983\"> long</span><span style=\"color:#D7827E\"> longValue</span><span style=\"color:#797593\">))</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                            Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: long\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                        else</span><span style=\"color:#286983\"> if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">TryGetDecimal</span><span style=\"color:#797593\">(</span><span style=\"color:#286983\">out</span><span style=\"color:#286983\"> decimal</span><span style=\"color:#D7827E\"> decimalValue</span><span style=\"color:#797593\">))</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                            Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: decimal\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                            string</span><span style=\"color:#D7827E\"> deserializedString</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> decimalValue</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">ToString</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"G29\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                            if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">deserializedString</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> jsonValue</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                            {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                                Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                                Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Original value: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                                Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Deserialized value: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">deserializedString</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                            }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                        else</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                            Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: unknown number\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                        break</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    default</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Deserialized as: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#286983\">.</span><span style=\"color:#575279;font-style:italic\">ValueKind</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                        break</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Serialize the value back to JSON</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                string</span><span style=\"color:#D7827E\"> serialized</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> JsonSerializer</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">Serialize</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">deserialized</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Check if the serialized value matches the original JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">serialized</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> jsonValue</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Round-tripping error detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Original: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">jsonValue</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Serialized: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">serialized</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            }</span></span>\n<span class=\"line\"><span style=\"color:#286983\">            catch</span><span style=\"color:#797593\"> (</span><span style=\"color:#56949F\">JsonException</span><span style=\"color:#D7827E\"> ex</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">$\"Deserialization error: </span><span style=\"color:#797593\">{</span><span style=\"color:#575279;font-style:italic\">ex</span><span style=\"color:#286983\">.</span><span style=\"color:#575279;font-style:italic\">Message</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">            Console</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">WriteLine</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"><span style=\"color:#797593\">        }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<h3 id=\"python-3-8-1\" tabindex=\"-1\">Python (3.8) <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">import</span><span style=\"color:#575279\"> json</span></span>\n<span class=\"line\"><span style=\"color:#286983\">import</span><span style=\"color:#575279\"> decimal</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">def</span><span style=\"color:#D7827E\"> test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#907AA9;font-style:italic\">number_literal</span><span style=\"color:#797593\">):</span></span>\n<span class=\"line\"><span style=\"color:#B4637A;font-style:italic\">    print</span><span style=\"color:#797593\">(</span><span style=\"color:#286983\">f</span><span style=\"color:#EA9D34\">\"Testing number literal: </span><span style=\"color:#286983\">{</span><span style=\"color:#575279\">number_literal</span><span style=\"color:#286983\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">    #</span><span style=\"color:#9893A5;font-style:italic\"> Deserialize the JSON number</span></span>\n<span class=\"line\"><span style=\"color:#575279\">    deserialized </span><span style=\"color:#286983\">=</span><span style=\"color:#575279\"> json</span><span style=\"color:#797593\">.</span><span style=\"color:#575279\">loads</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">number_literal</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">    #</span><span style=\"color:#9893A5;font-style:italic\"> Check for precision loss during deserialization</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    if</span><span style=\"color:#56949F\"> str</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">deserialized</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279\"> number_literal</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#B4637A;font-style:italic\">        print</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"  Precision loss during deserialization\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    else</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#B4637A;font-style:italic\">        print</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"  No precision loss during deserialization\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">    #</span><span style=\"color:#9893A5;font-style:italic\"> Serialize the deserialized number back to JSON</span></span>\n<span class=\"line\"><span style=\"color:#575279\">    serialized </span><span style=\"color:#286983\">=</span><span style=\"color:#575279\"> json</span><span style=\"color:#797593\">.</span><span style=\"color:#575279\">dumps</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">deserialized</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">    #</span><span style=\"color:#9893A5;font-style:italic\"> Check for round-tripping errors</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    if</span><span style=\"color:#575279\"> serialized </span><span style=\"color:#286983\">!=</span><span style=\"color:#575279\"> number_literal</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#B4637A;font-style:italic\">        print</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"  Round-tripping error\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    else</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#B4637A;font-style:italic\">        print</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"  No round-tripping error\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B4637A;font-style:italic\">    print</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">#</span><span style=\"color:#9893A5;font-style:italic\"> Test the JSON number literals</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"10\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"1000000000\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"10000000000000001\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"100000000000000000001\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"1\"</span><span style=\"color:#286983\"> +</span><span style=\"color:#EA9D34\"> \"0\"</span><span style=\"color:#286983\"> *</span><span style=\"color:#D7827E\"> 4301</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"10.0\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"10000000000000001.1\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"1.\"</span><span style=\"color:#286983\"> +</span><span style=\"color:#EA9D34\"> \"1\"</span><span style=\"color:#286983\"> *</span><span style=\"color:#D7827E\"> 34</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"1E2\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279\">test_json_number</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"1E309\"</span><span style=\"color:#797593\">)</span></span></code></pre>\n<h3 id=\"java-jdk-21-jackson\" tabindex=\"-1\">Java (JDK 21, Jackson) <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">import com</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">fasterxml</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">jackson</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">databind</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">JsonNode</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">import com</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">fasterxml</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">jackson</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">databind</span><span style=\"color:#797593\">.</span><span style=\"color:#286983\">ObjectMapper</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">public</span><span style=\"color:#286983\"> class</span><span style=\"color:#56949F\"> NumberTest</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    private</span><span style=\"color:#286983\"> static</span><span style=\"color:#286983\"> final</span><span style=\"color:#286983\"> String</span><span style=\"color:#797593\">[]</span><span style=\"color:#575279;font-style:italic\"> testCases</span><span style=\"color:#286983\"> =</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"100000000000000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1\"</span><span style=\"color:#286983\"> +</span><span style=\"color:#EA9D34\"> \"0\"</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">repeat</span><span style=\"color:#797593\">(</span><span style=\"color:#D7827E\">309</span><span style=\"color:#797593\">),</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10.0\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10000000000000001.1\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1.1111111111111111111111111111111111\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1E2\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1E309\"</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">    public</span><span style=\"color:#286983\"> static</span><span style=\"color:#286983\"> void</span><span style=\"color:#D7827E\"> main</span><span style=\"color:#797593\">(</span><span style=\"color:#286983\">String</span><span style=\"color:#797593\">[]</span><span style=\"color:#907AA9;font-style:italic\"> args</span><span style=\"color:#797593\">)</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">        ObjectMapper</span><span style=\"color:#575279;font-style:italic\"> objectMapper</span><span style=\"color:#286983\"> =</span><span style=\"color:#286983\"> new</span><span style=\"color:#D7827E\"> ObjectMapper</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">        for</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">String</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#286983\"> :</span><span style=\"color:#575279\"> testCases</span><span style=\"color:#797593\">)</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">            System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Testing JSON value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> testCase</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">            try</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Parse the JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                JsonNode</span><span style=\"color:#575279;font-style:italic\"> jsonNode</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> objectMapper</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">readTree</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">testCase</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Check the deserialized type and precision loss</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">isInt</span><span style=\"color:#797593\">())</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: int\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span><span style=\"color:#286983\"> else</span><span style=\"color:#286983\"> if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">isLong</span><span style=\"color:#797593\">())</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: long\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span><span style=\"color:#286983\"> else</span><span style=\"color:#286983\"> if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">isBigInteger</span><span style=\"color:#797593\">())</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: BigInteger\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    String</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">bigIntegerValue</span><span style=\"color:#797593\">().</span><span style=\"color:#D7827E\">toString</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    if</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">!</span><span style=\"color:#575279;font-style:italic\">deserializedString</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">equals</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">testCase</span><span style=\"color:#797593\">))</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> testCase</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> deserializedString</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span><span style=\"color:#286983\"> else</span><span style=\"color:#286983\"> if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">isDouble</span><span style=\"color:#797593\">())</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: double\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    String</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">doubleValue</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\"> +</span><span style=\"color:#EA9D34\"> \"\"</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    if</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">!</span><span style=\"color:#575279;font-style:italic\">deserializedString</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">equals</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">testCase</span><span style=\"color:#797593\">))</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> testCase</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> deserializedString</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span><span style=\"color:#286983\"> else</span><span style=\"color:#286983\"> if</span><span style=\"color:#797593\"> (</span><span style=\"color:#575279;font-style:italic\">jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">isDecimal</span><span style=\"color:#797593\">())</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: BigDecimal\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    String</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">decimalValue</span><span style=\"color:#797593\">().</span><span style=\"color:#D7827E\">toString</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                    if</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">!</span><span style=\"color:#575279;font-style:italic\">deserializedString</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">equals</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">testCase</span><span style=\"color:#797593\">))</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> testCase</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                        System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> deserializedString</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span><span style=\"color:#286983\"> else</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279;font-style:italic\"> jsonNode</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">getNodeType</span><span style=\"color:#797593\">());</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Serialize the value back to JSON</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                String</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> objectMapper</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">writeValueAsString</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">jsonNode</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Check if the serialized value matches the original JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                if</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">!</span><span style=\"color:#575279;font-style:italic\">serialized</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">equals</span><span style=\"color:#797593\">(</span><span style=\"color:#575279\">testCase</span><span style=\"color:#797593\">))</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Round-tripping error detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> testCase</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Serialized: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279\"> serialized</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            }</span><span style=\"color:#286983\"> catch</span><span style=\"color:#797593\"> (</span><span style=\"color:#286983\">Exception</span><span style=\"color:#907AA9;font-style:italic\"> e</span><span style=\"color:#797593\">)</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialization error: \"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279;font-style:italic\"> e</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">getMessage</span><span style=\"color:#797593\">());</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">            System</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">out</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">println</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"><span style=\"color:#797593\">        }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<h3 id=\"rust\" tabindex=\"-1\">Rust <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">use</span><span style=\"color:#56949F\"> serde_json</span><span style=\"color:#286983\">::</span><span style=\"color:#56949F\">Value</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">fn</span><span style=\"color:#D7827E\"> main</span><span style=\"color:#797593\">()</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">    let</span><span style=\"color:#575279;font-style:italic\"> json_values</span><span style=\"color:#286983\"> =</span><span style=\"color:#D7827E\"> vec!</span><span style=\"color:#797593\">[</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"100000000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10.0\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"10000000000000001.1\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1.1111111111111111111111111111111111\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1E2\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">        \"1E309\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    ];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">    for</span><span style=\"color:#575279;font-style:italic\"> json_value</span><span style=\"color:#286983\"> in</span><span style=\"color:#575279;font-style:italic\"> json_values</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">        println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Testing JSON value: </span><span style=\"color:#797593\">{}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> json_value</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">        //</span><span style=\"color:#9893A5;font-style:italic\"> Deserialize the JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">        let</span><span style=\"color:#575279;font-style:italic\"> deserialized</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> Result</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Value</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> _</span><span style=\"color:#797593\">></span><span style=\"color:#286983\"> =</span><span style=\"color:#56949F\"> serde_json</span><span style=\"color:#286983\">::</span><span style=\"color:#D7827E\">from_str</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">json_value</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">        match</span><span style=\"color:#575279;font-style:italic\"> deserialized</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">            Ok</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">value</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\"> =></span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Check the deserialized type and precision loss</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                match</span><span style=\"color:#286983\"> &#x26;</span><span style=\"color:#575279;font-style:italic\">value</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">                    Value</span><span style=\"color:#286983\">::</span><span style=\"color:#D7827E\">Number</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">num</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\"> =></span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                        if</span><span style=\"color:#575279;font-style:italic\"> num</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">is_i64</span><span style=\"color:#797593\">()</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                            println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: i64\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span><span style=\"color:#286983\"> else</span><span style=\"color:#286983\"> if</span><span style=\"color:#575279;font-style:italic\"> num</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">is_u64</span><span style=\"color:#797593\">()</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                            println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: u64\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span><span style=\"color:#286983\"> else</span><span style=\"color:#286983\"> if</span><span style=\"color:#575279;font-style:italic\"> num</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">is_f64</span><span style=\"color:#797593\">()</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                            println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: f64\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                            let</span><span style=\"color:#575279;font-style:italic\"> deserialized_value</span><span style=\"color:#286983\"> =</span><span style=\"color:#575279;font-style:italic\"> num</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">as_f64</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">unwrap</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">to_string</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                            if</span><span style=\"color:#575279;font-style:italic\"> deserialized_value</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> json_value</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                                println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                                println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: </span><span style=\"color:#797593\">{}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> json_value</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                                println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: </span><span style=\"color:#797593\">{}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> deserialized_value</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                            }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                        }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                    }</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">                    _</span><span style=\"color:#286983\"> =></span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                        println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: </span><span style=\"color:#797593\">{</span><span style=\"color:#EA9D34\">:?</span><span style=\"color:#797593\">}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> value</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Serialize the value back to JSON</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                let</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#286983\"> =</span><span style=\"color:#56949F\"> serde_json</span><span style=\"color:#286983\">::</span><span style=\"color:#D7827E\">to_string</span><span style=\"color:#797593\">(</span><span style=\"color:#286983\">&#x26;</span><span style=\"color:#575279;font-style:italic\">value</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\">.</span><span style=\"color:#D7827E\">unwrap</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">                //</span><span style=\"color:#9893A5;font-style:italic\"> Check if the serialized value matches the original JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">                if</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> json_value</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                    println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Round-tripping error detected!\"</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                    println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original: </span><span style=\"color:#797593\">{}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> json_value</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                    println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Serialized: </span><span style=\"color:#797593\">{}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> serialized</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">                }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            }</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">            Err</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">e</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\"> =></span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E\">                println!</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialization error: </span><span style=\"color:#797593\">{}</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> e</span><span style=\"color:#797593\">);</span></span>\n<span class=\"line\"><span style=\"color:#797593\">            }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">        }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D7827E\">        println!</span><span style=\"color:#797593\">();</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    }</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<h3 id=\"go-1\" tabindex=\"-1\">Go <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/what-is-a-json-number/\">#</a></h3>\n<p>This code demonstrates the default behavior:</p>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">package</span><span style=\"color:#56949F\"> main</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">import</span><span style=\"color:#797593\"> (</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">encoding/json</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">fmt</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">strconv</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">strings</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">func</span><span style=\"color:#D7827E\"> main</span><span style=\"color:#797593\">()</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\ttestCases</span><span style=\"color:#286983\"> :=</span><span style=\"color:#797593\"> []</span><span style=\"color:#286983\">string</span><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"10\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"1000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"10000000000000001\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"100000000000000000000\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"1\"</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279;font-style:italic\"> strings</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Repeat</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"0\"</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 309</span><span style=\"color:#797593\">),</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"10.0\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"10000000000000001.1\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"1.1111111111111111111111111111111111\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"1E2\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t\"1E309\"</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">\tfor</span><span style=\"color:#575279;font-style:italic\"> _</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#286983\"> :=</span><span style=\"color:#286983\"> range</span><span style=\"color:#575279;font-style:italic\"> testCases</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Testing JSON value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Unmarshal the JSON value into a float64</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tvar</span><span style=\"color:#575279;font-style:italic\"> value</span><span style=\"color:#286983\"> float64</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\terr</span><span style=\"color:#286983\"> :=</span><span style=\"color:#575279;font-style:italic\"> json</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Unmarshal</span><span style=\"color:#797593\">([]</span><span style=\"color:#286983\">byte</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">testCase</span><span style=\"color:#797593\">),</span><span style=\"color:#286983\"> &#x26;</span><span style=\"color:#575279;font-style:italic\">value</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> nil</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialization error: </span><span style=\"color:#286983\">%v\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\tcontinue</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: float64\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Check for precision loss</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tdeserializedString</span><span style=\"color:#286983\"> :=</span><span style=\"color:#575279;font-style:italic\"> strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatFloat</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">value</span><span style=\"color:#797593\">,</span><span style=\"color:#EA9D34\"> '</span><span style=\"color:#286983\">g</span><span style=\"color:#EA9D34\">'</span><span style=\"color:#797593\">,</span><span style=\"color:#286983\"> -</span><span style=\"color:#D7827E\">1</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 64</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Serialize the value back to JSON</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tserialized</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#286983\"> :=</span><span style=\"color:#575279;font-style:italic\"> json</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Marshal</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">value</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> nil</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Serialization error: </span><span style=\"color:#286983\">%v\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\tcontinue</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Check if the serialized value matches the original JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#286983\"> string</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">serialized</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Round-tripping error detected!\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Serialized: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#286983\"> string</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">serialized</span><span style=\"color:#797593\">))</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<p>This code demonstrates deserializing into a struct of a known shape:</p>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">package</span><span style=\"color:#56949F\"> main</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">import</span><span style=\"color:#797593\"> (</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">encoding/json</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">fmt</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">math/big</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">strconv</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\"</span><span style=\"color:#D7827E\">strings</span><span style=\"color:#EA9D34\">\"</span></span>\n<span class=\"line\"><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">type</span><span style=\"color:#56949F\"> TestCase</span><span style=\"color:#286983\"> struct</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tName</span><span style=\"color:#286983\">  string</span><span style=\"color:#EA9D34\">  `json:\"name\"`</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tInt8</span><span style=\"color:#286983\">  int8</span><span style=\"color:#EA9D34\">    `json:\"int8,omitempty\"`</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tInt16</span><span style=\"color:#286983\"> int16</span><span style=\"color:#EA9D34\">   `json:\"int16,omitempty\"`</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tInt32</span><span style=\"color:#286983\"> int32</span><span style=\"color:#EA9D34\">   `json:\"int32,omitempty\"`</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tInt64</span><span style=\"color:#286983\"> int64</span><span style=\"color:#EA9D34\">   `json:\"int64,omitempty\"`</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\tFloat</span><span style=\"color:#286983\"> float64</span><span style=\"color:#EA9D34\"> `json:\"float,omitempty\"`</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">func</span><span style=\"color:#D7827E\"> main</span><span style=\"color:#797593\">()</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\ttestCases</span><span style=\"color:#286983\"> :=</span><span style=\"color:#797593\"> []</span><span style=\"color:#286983\">string</span><span style=\"color:#797593\">{</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Small integer\", \"int8\": 10}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Medium integer\", \"int32\": 1000000000}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Large integer\", \"int64\": 10000000000000001}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Huge integer\", \"int64\": 100000000000000000001}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Ridonculous integer\", \"int64\": 1`</span><span style=\"color:#286983\"> +</span><span style=\"color:#575279;font-style:italic\"> strings</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Repeat</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"0\"</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 309</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\"> +</span><span style=\"color:#EA9D34\"> `}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Low-precision decimal\", \"float\": 10.0}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"High-precision decimal\", \"float\": 10000000000000001.1}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Ridonculous-precision decimal\", \"float\": 1.1111111111111111111111111111111111}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Small exponential\", \"float\": 1E2}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#EA9D34\">\t\t`{\"name\": \"Large exponential\", \"float\": 1E309}`</span><span style=\"color:#797593\">,</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">\tfor</span><span style=\"color:#575279;font-style:italic\"> _</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> testCase</span><span style=\"color:#286983\"> :=</span><span style=\"color:#286983\"> range</span><span style=\"color:#575279;font-style:italic\"> testCases</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tvar</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#56949F\"> TestCase</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\terr</span><span style=\"color:#286983\"> :=</span><span style=\"color:#575279;font-style:italic\"> json</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Unmarshal</span><span style=\"color:#797593\">([]</span><span style=\"color:#286983\">byte</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">testCase</span><span style=\"color:#797593\">),</span><span style=\"color:#286983\"> &#x26;</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> nil</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialization error: </span><span style=\"color:#286983\">%v\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\tcontinue</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Testing: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Name</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Check the deserialized type and precision loss</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tswitch</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tcase</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int8</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> 0</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: int8\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tcase</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int16</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> 0</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: int16\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tcase</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int32</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> 0</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: int32\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tcase</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int64</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> 0</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: int64\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\tif</span><span style=\"color:#575279;font-style:italic\"> tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Name</span><span style=\"color:#286983\"> ==</span><span style=\"color:#EA9D34\"> \"Ridonculous integer\"</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\tbigInt</span><span style=\"color:#286983\"> :=</span><span style=\"color:#D7827E\"> new</span><span style=\"color:#797593\">(</span><span style=\"color:#56949F\">big</span><span style=\"color:#797593\">.</span><span style=\"color:#56949F\">Int</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\tbigInt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">SetString</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatInt</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int64</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 10</span><span style=\"color:#797593\">),</span><span style=\"color:#D7827E\"> 10</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\t\tif</span><span style=\"color:#575279;font-style:italic\"> bigInt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">String</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatInt</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int64</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 10</span><span style=\"color:#797593\">)</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatInt</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Int64</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 10</span><span style=\"color:#797593\">))</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> bigInt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">String</span><span style=\"color:#797593\">())</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tdefault</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized as: float64\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tdeserializedString</span><span style=\"color:#286983\"> :=</span><span style=\"color:#575279;font-style:italic\"> strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatFloat</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Float</span><span style=\"color:#797593\">,</span><span style=\"color:#EA9D34\"> '</span><span style=\"color:#286983\">g</span><span style=\"color:#EA9D34\">'</span><span style=\"color:#797593\">,</span><span style=\"color:#286983\"> -</span><span style=\"color:#D7827E\">1</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 64</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\tif</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatFloat</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Float</span><span style=\"color:#797593\">,</span><span style=\"color:#EA9D34\"> '</span><span style=\"color:#286983\">f</span><span style=\"color:#EA9D34\">'</span><span style=\"color:#797593\">,</span><span style=\"color:#286983\"> -</span><span style=\"color:#D7827E\">1</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 64</span><span style=\"color:#797593\">)</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Precision loss detected!\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> strconv</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">FormatFloat</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">.</span><span style=\"color:#575279;font-style:italic\">Float</span><span style=\"color:#797593\">,</span><span style=\"color:#EA9D34\"> '</span><span style=\"color:#286983\">f</span><span style=\"color:#EA9D34\">'</span><span style=\"color:#797593\">,</span><span style=\"color:#286983\"> -</span><span style=\"color:#D7827E\">1</span><span style=\"color:#797593\">,</span><span style=\"color:#D7827E\"> 64</span><span style=\"color:#797593\">))</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Deserialized value: </span><span style=\"color:#286983\">%s\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> deserializedString</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Serialize the value back to JSON</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tserialized</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#286983\"> :=</span><span style=\"color:#575279;font-style:italic\"> json</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Marshal</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">tc</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#286983\"> !=</span><span style=\"color:#D7827E\"> nil</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Serialization error: </span><span style=\"color:#286983\">%v\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> err</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\t\tcontinue</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#797593;font-style:italic\">\t\t//</span><span style=\"color:#9893A5;font-style:italic\"> Check if the serialized value matches the original JSON value</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tvar</span><span style=\"color:#575279;font-style:italic\"> originalTC</span><span style=\"color:#56949F\"> TestCase</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tjson</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Unmarshal</span><span style=\"color:#797593\">([]</span><span style=\"color:#286983\">byte</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">testCase</span><span style=\"color:#797593\">),</span><span style=\"color:#286983\"> &#x26;</span><span style=\"color:#575279;font-style:italic\">originalTC</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tvar</span><span style=\"color:#575279;font-style:italic\"> serializedTC</span><span style=\"color:#56949F\"> TestCase</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tjson</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Unmarshal</span><span style=\"color:#797593\">(</span><span style=\"color:#575279;font-style:italic\">serialized</span><span style=\"color:#797593\">,</span><span style=\"color:#286983\"> &#x26;</span><span style=\"color:#575279;font-style:italic\">serializedTC</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">\t\tif</span><span style=\"color:#575279;font-style:italic\"> originalTC</span><span style=\"color:#286983\"> !=</span><span style=\"color:#575279;font-style:italic\"> serializedTC</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Round-tripping error detected!\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Original: </span><span style=\"color:#286983\">%+v\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> originalTC</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Printf</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"Serialized: </span><span style=\"color:#286983\">%+v\\n</span><span style=\"color:#EA9D34\">\"</span><span style=\"color:#797593\">,</span><span style=\"color:#575279;font-style:italic\"> serializedTC</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#575279;font-style:italic\">\t\tfmt</span><span style=\"color:#797593\">.</span><span style=\"color:#D7827E\">Println</span><span style=\"color:#797593\">()</span></span>\n<span class=\"line\"><span style=\"color:#797593\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p>This additional restriction might seem to violate ECMA-404 at first glance, but it's really just acknowledging the reality that implementations are free to set such limits. If this weren't the case, no JSON parser could be standards compliant since they have to run in reality where hardware and software constraints exist. <a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn2\" class=\"footnote-item\"><p>This limit used to be much higher, but it was found to be a DoS vector, so more recent versions of python limited the string length of an <code>int</code> to a paltry 4300 digits. This can be configured to a more reasonable value by calling <code>sys.set_int_max_str_digits</code> or setting the <code>PYTHONINTMAXSTRDIGITS</code> environment variable. <a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn3\" class=\"footnote-item\"><p>The <a href=\"https://typespec.io\">TypeSpec</a> team proposed adding double-int to the format registry to represent an integer that can fit as a double, which would eventually serve as the output target for <code>safeint</code>. For reasons of compatibility with the current ecosystem, TypeSpec continues to emit <code>safeint</code> with the <code>int64</code> format. <a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn4\" class=\"footnote-item\"><p>This likely explains my observation that folks don't tend to worry much when putting an <code>int64</code> on the wire. Poor JavaScript :( <a href=\"https://blog.trl.sn/blog/what-is-a-json-number/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n</ol>\n</section>\n",
			"date_published": "2024-04-01T00:00:00Z"
		}
		,
		{
			"id": "https://blog.trl.sn/blog/typespec-for-openapi/",
			"url": "https://blog.trl.sn/blog/typespec-for-openapi/",
			"title": "Write OpenAPI with TypeSpec",
			"content_html": "<p>I've spent the last few years at Microsoft working on an API definition language called <a href=\"https://typespec.io\">TypeSpec</a>. It's essentially a super flexible protocol-agnostic DSL for describing API shapes. You can try it in your browser at the <a href=\"https://typespec.io/playground\">TypeSpec playground</a>. Many things about it are exciting, but I want to talk about one thing in particular: why TypeSpec is the best way to write OpenAPI.</p>\n<h2 id=\"openapi-the-good-and-the-not-so-good\" tabindex=\"-1\">OpenAPI: the good and the not-so-good <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/typespec-for-openapi/\">#</a></h2>\n<p>OpenAPI is pretty great at describing the low level details of how an HTTP API works. It allows software to understand the shape of an API which in turn enables myriad useful things, like generating clients and documentation, configuring API gateways, or generating test cases. The fact that OpenAPI is the most widely used language to describe HTTP APIs is a testament to these strengths.</p>\n<p>However, after working with OpenAPI inside Azure, it is also clear to me that OpenAPI suffers a few critical weaknesses. Humans don't find OpenAPI particularly pleasant to author and review, whether in JSON or YAML. The code generation from OpenAPI is often not stellar despite heroic efforts from many in the community<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" id=\"fnref1\">[1]</a></sup>. It also struggles when building APIs at scale where its verbosity and lack of reusable components require significant investment in API reviews and governance process.</p>\n<p>I believe API-first development principles<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" id=\"fnref2\">[2]</a></sup> are great in theory, but in practice API-first with OpenAPI faces significant headwinds. Developers are likely to opt for code-first approaches that generate OpenAPI as a build artifact. I believe TypeSpec changes the game. Let's see how!</p>\n<h2 id=\"enter-typespec\" tabindex=\"-1\">Enter TypeSpec <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/typespec-for-openapi/\">#</a></h2>\n<p>TypeSpec is designed to be protocol agonstic, but the team has invested heavily in making great OpenAPI 3.0 emit. You can use TypeSpec to define most OpenAPI documents<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" id=\"fnref3\">[3]</a></sup> by using its <code>http</code> standard library which provides various types and decorators to add http-specific metadata like headers, query strings, or status codes. Writing OpenAPI in TypeSpec has many advantages over using OpenAPI directly. What I'll cover today is that TypeSpecs are smaller, more readable, and can use API components.</p>\n<h3 id=\"terse-and-expressive\" tabindex=\"-1\">Terse &amp; expressive <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/typespec-for-openapi/\">#</a></h3>\n<p>TypeSpec's syntax and semantics borrow heavily from TypeScript, which is one of the best languages for describing REST API shapes<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" id=\"fnref4\">[4]</a></sup>. TypeSpec is able to describe complex model shapes and REST endpoints with substantially less typing than OpenAPI, and the end result is much more readable. I've even heard from folks who successfully use TypeSpec syntax to discuss API shapes with non-technical stakeholders!</p>\n<p>Let's look at an example of what I mean. You can view the resulting OpenAPI <a href=\"https://typespec.io/playground?c=aW1wb3J0ICJAdHlwZXNwZWMvaHR0cCI7DQp1c2luZyBIdHRwOw0KDQovKiogQSBjaGFyYWN0ZXIgaW4gYSBmYW50YXN5IFJQRy1zdHlsZSBnYW1lICovDQptb2RlbCBDyTB7DQogIG5hbWU6IHN0cmluZzvEEWlkOiBzYWZlaW50xRBzdGF0dXM6ICJBbGl2ZSIgfCAiRGVhZOQAkCAgY2xhc3M6IEPEBzsNCn3kAJdlbnVtxhIgeyB3YXJyaW9yOyB3aXphcmQ7IMUjQG1pblZhbHVlKDEpxA5heMYOMjApDQpzY2FsYXLFeMUWIGV4dGVuZHMgdWludDjlAPrmAMpTdGF0c%2BYAxnN0cmVuZ3Ro5ADKxzfmAM1udGVsbGlnZW5j5QDmzBxkxFhyaXR5zhnlAKFvcCBnZXTpASsoQHBhdGjsARspOuoBSTs%3D&amp;e=%40typespec%2Fopenapi3&amp;options=%7B%7D\">in the playground</a>.</p>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">import</span><span style=\"color:#EA9D34\"> \"@typespec/http\"</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#286983\">using</span><span style=\"color:#56949F\"> Http</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9893A5;font-style:italic\">/** A character in a fantasy RPG-style game */</span></span>\n<span class=\"line\"><span style=\"color:#286983\">model</span><span style=\"color:#56949F\"> Character</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  name</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> string</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  id</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> safeint</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  status</span><span style=\"color:#286983\">:</span><span style=\"color:#EA9D34\"> \"Alive\"</span><span style=\"color:#575279\"> | </span><span style=\"color:#EA9D34\">\"Dead\"</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  class</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> Class</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">enum</span><span style=\"color:#56949F\"> Class</span><span style=\"color:#797593\"> {</span><span style=\"color:#D7827E;font-style:italic\"> warrior</span><span style=\"color:#797593\">;</span><span style=\"color:#D7827E;font-style:italic\"> wizard</span><span style=\"color:#797593\">;</span><span style=\"color:#797593\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#56949F\">@minValue</span><span style=\"color:#797593\">(</span><span style=\"color:#D7827E\">1</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">@maxValue</span><span style=\"color:#797593\">(</span><span style=\"color:#D7827E\">20</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">scalar</span><span style=\"color:#56949F\"> statValue</span><span style=\"color:#286983\"> extends</span><span style=\"color:#56949F\"> uint8</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">model</span><span style=\"color:#56949F\"> Stats</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  strength</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> statValue</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  intelligence</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> statValue</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  dexterity</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> statValue</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#286983\">op</span><span style=\"color:#D7827E\"> getCharacter</span><span style=\"color:#797593\">(</span><span style=\"color:#56949F\">@path</span><span style=\"color:#D7827E;font-style:italic\"> id</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> safeint</span><span style=\"color:#797593\">)</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> Character</span><span style=\"color:#797593\">;</span></span></code></pre>\n<figcaption>A partial TypeSpec API definition for a fantasy RPG</figcaption></figure>\n<p>This TypeSpec ultimately compiles to OpenAPI that is almost 3x the number of lines, and 3.5x as many bytes. The TypeSpec code is fairly easy to read and followâ€”certainly familiar to TypeScript developers, but also obvious enough that anyone can get the gist.</p>\n<p>TypeSpec unions in particular demonstrate how TypeSpec's syntax significantly improves readability. Unions provide a single terse syntax that compile to OpenAPI's <code>oneOf</code>, <code>anyOf</code>, and <code>enum</code> constructs. Consider the following TypeSpec and OpenAPI:</p>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">model</span><span style=\"color:#56949F\"> Character</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#9893A5;font-style:italic\">  // ... snip other fields ...</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  status</span><span style=\"color:#286983\">:</span><span style=\"color:#EA9D34\"> \"Alive\"</span><span style=\"color:#575279\"> | </span><span style=\"color:#EA9D34\">\"Dead\"</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<figcaption>A TypeSpec union of literal types</figcaption></figure>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#56949F\">status</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">  type</span><span style=\"color:#797593\">:</span><span style=\"color:#EA9D34\"> string</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">  enum</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    -</span><span style=\"color:#EA9D34\"> Alive</span></span>\n<span class=\"line\"><span style=\"color:#797593\">    -</span><span style=\"color:#EA9D34\"> Dead</span></span></code></pre>\n<figcaption>OpenAPI output for a union of literal types</figcaption></figure>\n<p>The compiler determined that this was a union of literal types and so the right choice was to emit it as an enum. But if we have a union of object types, it compiles into an anyOf<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" id=\"fnref5\">[5]</a></sup>.</p>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">model</span><span style=\"color:#56949F\"> Character</span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#9893A5;font-style:italic\">  // ... snip other fields ...</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  items</span><span style=\"color:#286983\">:</span><span style=\"color:#797593\"> (</span><span style=\"color:#56949F\">Weapon</span><span style=\"color:#575279\"> | </span><span style=\"color:#56949F\">Armor</span><span style=\"color:#575279\"> | </span><span style=\"color:#56949F\">GenericItem</span><span style=\"color:#797593\">)[]</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span></code></pre>\n<figcaption>A TypeSpec union of objects</figcaption>\n</figure>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#56949F\">items</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">  type</span><span style=\"color:#797593\">:</span><span style=\"color:#EA9D34\"> array</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">  items</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#56949F\">    anyOf</span><span style=\"color:#797593\">:</span></span>\n<span class=\"line\"><span style=\"color:#797593\">      -</span><span style=\"color:#56949F\"> $ref</span><span style=\"color:#797593\">:</span><span style=\"color:#EA9D34\"> \"#/components/schemas/Weapon\"</span></span>\n<span class=\"line\"><span style=\"color:#797593\">      -</span><span style=\"color:#56949F\"> $ref</span><span style=\"color:#797593\">:</span><span style=\"color:#EA9D34\"> \"#/components/schemas/Armor\"</span></span>\n<span class=\"line\"><span style=\"color:#797593\">      -</span><span style=\"color:#56949F\"> $ref</span><span style=\"color:#797593\">:</span><span style=\"color:#EA9D34\"> \"#/components/schemas/GenericItem\"</span></span></code></pre>\n<figcaption>OpenAPI output for a union of objects</figcaption>\n</figure>\n<p>Overall, TypeSpec's various language features compile to OpenAPI that is generally longer and more complex, both in terms of syntax and semantics.</p>\n<h3 id=\"composable-and-modular\" tabindex=\"-1\">Composable &amp; modular <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/typespec-for-openapi/\">#</a></h3>\n<p>The ability to encapsulate API patterns into reusable components was one of the main reasons why we started working on TypeSpec in the first place. At scale, consistency across APIs and conformance with API guidelines becomes quite costly. Monumental effort is required from both API authors and API reviewers to ensure quality.</p>\n<p>TypeSpec's API components make consistency easy. API designers can encapsulate blessed API patterns into components that API authors import and use. In this way, API designers are assured that the API is correct simply by virtue of using the component, and API authors don't need to implement complex high-level patterns in JSON.</p>\n<p>A common example is pagination<sup class=\"footnote-ref\"><a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" id=\"fnref6\">[6]</a></sup>. Using TypeSpec, we can define a template that defines the shape of our page, and use that for every paged endpoint.</p>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">model</span><span style=\"color:#56949F\"> Page</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">T</span><span style=\"color:#797593\">></span><span style=\"color:#797593\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  items</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> T</span><span style=\"color:#797593\">[];</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  size</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> int32</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  nextLink</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> url</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#D7827E;font-style:italic\">  prevLink</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> url</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"><span style=\"color:#797593\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#56949F\">@route</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"/characters\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">op</span><span style=\"color:#D7827E\"> listCharacters</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> Page</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Character</span><span style=\"color:#797593\">>;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#56949F\">@route</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"/items\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">op</span><span style=\"color:#D7827E\"> listItems</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> Page</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Item</span><span style=\"color:#797593\">>;</span></span></code></pre>\n<figcaption>A TypeSpec for paginated endpoints</figcaption>\n</figure>\n<p>Another common use for templates is defining your standard error shapes. For example, if every endpoint might return a <code>403</code> error, we can express that with a template:</p>\n<figure>\n<pre class=\"shiki rose-pine-dawn\" style=\"background-color:#faf4ed;color:#575279\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#286983\">alias</span><span style=\"color:#56949F\"> WithStandardErrors</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">T</span><span style=\"color:#797593\">></span><span style=\"color:#286983\"> =</span><span style=\"color:#56949F\"> T</span><span style=\"color:#575279\"> | </span><span style=\"color:#56949F\">ForbiddenResponse</span><span style=\"color:#797593\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#56949F\">@route</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"/characters\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">op</span><span style=\"color:#D7827E\"> listCharacters</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> WithStandardErrors</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Page</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Character</span><span style=\"color:#797593\">>>;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#56949F\">@route</span><span style=\"color:#797593\">(</span><span style=\"color:#EA9D34\">\"/items\"</span><span style=\"color:#797593\">)</span></span>\n<span class=\"line\"><span style=\"color:#286983\">op</span><span style=\"color:#D7827E\"> listItems</span><span style=\"color:#797593\">()</span><span style=\"color:#286983\">:</span><span style=\"color:#56949F\"> WithStandardErrors</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Page</span><span style=\"color:#797593\">&#x3C;</span><span style=\"color:#56949F\">Item</span><span style=\"color:#797593\">>>;</span></span></code></pre>\n<figcaption>A TypeSpec for standard response shapes</figcaption>\n</figure>\n<p>In Azure, we have dozens of these templates, which encapsulate the API patterns we use across Azure's API surface area. We package these templates into modules that are imported by service owners when they're writing their API spec. They don't need to know that a &quot;long-running operation&quot; uses a particular HTTP verb with a payload of a specific shape, they just provide the long-running operation template a couple parameters specific to their API and they're done. API authors are happy, reviewers are happy.</p>\n<h2 id=\"wrapping-up\" tabindex=\"-1\">Wrapping up <a class=\"header-anchor\" href=\"https://blog.trl.sn/blog/typespec-for-openapi/\">#</a></h2>\n<p>This just scratches the surface of what it's possible to do with TypeSpec. There are many other features that combine to make TypeSpec extremely productive to use, producing OpenAPI documents that can be well over 10x the size. When writing APIs is this productive, I think API-first starts to look not only viable, but attractive.</p>\n<p>In later posts, I'll be sharing some more details about fun things TypeSpec can do. Topics may include its support for other protocols (e.g. Protobuf, JSON Schema), TypeSpec's extensibility model and how you can add your own decorators or emit your own output using TypeScript, how TypeSpec enables higher quality code generation, and future directions around pagination and support for streaming APIs. If you're interested in a particular topic, feel free to say so on <a href=\"https://twitter.com/bterlson\">twitter</a>.</p>\n<hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p>OpenAPI doesn't make it easy to generate good code. JSON Schema is a great vocabulary for generating data validators but not great at driving high quality codegen. Microsoft's attempts to get good codegen from OpenAPI involved <a href=\"http://azure.github.io/autorest/extensions/\">a number of proprietary extensions</a>. <a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn2\" class=\"footnote-item\"><p>API first refers to the practice of building your API specification up front, before any code is written, ensuring the API meets business requirements before committing to code and, in theory, resulting in improved consistency, reusability, and faster development time. <a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn3\" class=\"footnote-item\"><p>Some lesser-used features are not supported, like callbacks, but we're working on them. Some more-often-used features are also not supported, but we are working on them as we speak, like examples and xml. <a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn4\" class=\"footnote-item\"><p>This shouldn't be a surprise - TypeScript is a superset of JavaScript, aka the J in JSON. <a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn5\" class=\"footnote-item\"><p>OpenAPI afficianados will likely question this choice. Much discussion was had about whether oneOf or anyOf would be most appropriate here. Ultimately my opinion is it doesn't matter so much, in practice the ecosystem seems to treat both <code>anyOf</code> and <code>allOf</code> as the same thing. If you need the other choice, you can use the <code>@oneOf</code> decorator from the <code>@typespec/openapi</code> package. <a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n<li id=\"fn6\" class=\"footnote-item\"><p>Pagination is an area that TypeSpec has some additional work to do. While OpenAPI doesn't have the ability to explicitly define paginated endpoints, I believe clients should know that an endpoint is paginated so it can expose a friendlier interface to iterate over all the items in the collection. <a href=\"https://blog.trl.sn/blog/typespec-for-openapi/\" class=\"footnote-backref\">â†©ï¸Ž</a></p>\n</li>\n</ol>\n</section>\n",
			"date_published": "2024-03-25T00:00:00Z"
		}
		
	]
}
